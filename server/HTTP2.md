# HTTP2.0

目录



## 延迟原因

- 浏览器阻塞：浏览器会因为一些原因阻塞请求。浏览器对于同一个域名，同时只能有 4~10 个连接，超过浏览器最大连接数限制，后续请求就会被阻塞。
- DNS 查询：浏览器需要知道目标服务器的 IP 才能建立连接。
- 建立连接：HTTP 是基于 TCP 协议的，浏览器最快也要在第三次握手时才能捎带 HTTP 请求报文，达到真正的建立连接，但是这些连接无法复用会导致每次请求都经历三次握手和慢启动。

## 二进制分帧层

二进制分帧层，是HTTP 2.0性能增强的核心。

![](http2-model.jpg)

HTTP 1.x在应用层以纯文本的形式进行通信，而HTTP 2.0将所有的传输信息分割为更小的消息和帧，并对它们采用二进制格式编码。HTTP 2.0的格式定义更接近TCP层的方式，这种二机制的方式十分高效且精简。

## 多路复用

![](http2-multiplexing.png)

所有HTTP 2.0通信都在一个TCP连接上完成，这个连接可以承载任意数量的双向数据流。相应地，每个数据流以消息的形式发送，而消息由一或多个帧组成，这些帧可以乱序发送，然后根据每个帧首部的流标识符重新组装。

## 首部压缩

![](http2-compress.jpg)

HTTP 1.x每一次通信（请求/响应）都会携带首部信息用于描述资源属性。HTTP 2.0在客户端和服务端之间使用“首部表”来跟踪和存储之前发送的键-值对。首部表在连接过程中始终存在，新增的键-值对会更新到表尾，因此，不需要每次通信都需要再携带首部。

HTTP 2.0使用了专门为首部压缩而设计的 HPACK 算法。

## 服务端推送 

![](http2-push.jpg)

HTTP 2.0增加了服务端推送功能，服务端可以根据客户端的请求，提前返回多个响应，推送额外的资源给客户端。

## 请求优先级

HTTP 2.0允许浏览器指定资源的优先级。每个HTTP 2.0流里面有个优先值，这个优先值确定着客户端和服务器处理不同的流采取不同的优先级策略，高优先级的流都应该优先发送，但又不会是绝对的。